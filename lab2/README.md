# ROS 2 éšè— Topic å‘çŽ°ä¸Žå‚æ•°æ³„æ¼ï¼ˆLab2ï¼‰

> **Level 2ï¼šéšè— Topic å‘çŽ°ï¼ˆDiscovery æ”»å‡»ï¼‰**

> æ”»å‡»ç›®æ ‡ï¼šé€šè¿‡ Discovery æ”»å‡»å‘çŽ°éšè—çš„ Topic åŠå‚æ•°ï¼ŒèŽ·å–æ½œåœ¨çš„æ•æ„Ÿä¿¡æ¯ã€‚

---

# 1. é¶åœºèƒŒæ™¯

æ­¤æ¬¡æ¸—é€æµ‹è¯•çš„ç›®æ ‡ä¸º**Quiksand Lab2** çŽ¯å¢ƒï¼Œæ ¸å¿ƒå›´ç»• ROS 2 ç³»ç»Ÿçš„ Discovery æ”»å‡»ä¸Žå‚æ•°æ³„æ¼å±•å¼€ã€‚

åœ¨é»˜è®¤é…ç½®ä¸‹ï¼š

- é˜²å®ˆç­–ç•¥æœªå…¬å¸ƒ launch æ–‡ä»¶

- ROS 2 èŠ‚ç‚¹åŸºäºŽ DDS åè®®é€šä¿¡ï¼Œé»˜è®¤å¼€å¯ Discovery æœºåˆ¶

è¿™æ„å‘³ç€ï¼š

> **ä»»ä½•èƒ½æŽ¥å…¥åŒä¸€ DDS Domain çš„èŠ‚ç‚¹ï¼Œéƒ½å¯ä»¥æŽ¢æµ‹åˆ°éšè—çš„ Topic ä¸Žå‚æ•°ï¼Œæ— éœ€é¢å¤–æŽˆæƒå³å¯èŽ·å–æ•æ„Ÿä¿¡æ¯ã€‚**

åœ¨çœŸå®žæœºå™¨äººç³»ç»Ÿä¸­ï¼Œå¦‚æžœæ ¸å¿ƒå‚æ•°ï¼ˆå¦‚å¯†é’¥ã€è®¾å¤‡æ ‡è¯†ï¼‰æˆ–æŽ§åˆ¶ç±» Topic æœªåŠ é˜²æŠ¤ï¼Œå°†ç›´æŽ¥å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€æœºå™¨äººè¢«éžæ³•æŽ¢æµ‹ç­‰é£Žé™©ã€‚

---

# 2. æ”»å‡»åœºæ™¯è¯´æ˜Ž

## 2.1 ç³»ç»Ÿè§’è‰²

|è§’è‰²|è¯´æ˜Ž|
|---|---|
|quiksend_node2|ç›®æ ‡èŠ‚ç‚¹ï¼Œè¿è¡ŒäºŽ Docker å®¹å™¨å†…ï¼ŒåŒ…å«éšè—å‚æ•°åŠæ•æ„Ÿä¿¡æ¯|
|monitor_node|éšè—ç›‘æŽ§èŠ‚ç‚¹ï¼Œå…³è”æ•æ„Ÿå‚æ•°ï¼Œæ³„æ¼åŽè¾“å‡º flag|
|æ”»å‡»è€…ï¼ˆçº¢é˜Ÿï¼‰|å®¿ä¸»æœº/å®¹å™¨å†…æ”»å‡»è€…ï¼Œä½¿ç”¨ ROS 2 å·¥å…·åŠæŠ“åŒ…å·¥å…·å®žæ–½ Discovery æ”»å‡»|
---

## 2.2 æ”»å‡»ç›®æ ‡

- ðŸŽ¯ Topic/å‚æ•°ï¼šéšè—å‚æ•° `sys.runtime.seed`ï¼ˆå…³è”éšè— Topic å…ƒæ•°æ®ï¼‰

- ðŸŽ¯ åè®®/å·¥å…·ï¼šDDS Discovery åè®®ã€ROS 2 å‘½ä»¤è¡Œå·¥å…·ã€Wireshark/TCPDump

- ðŸŽ¯ æ•ˆæžœï¼š
        

    - å‘çŽ°ç›®æ ‡èŠ‚ç‚¹æš´éœ²çš„éšè—å‚æ•°

    - è¯»å–å‚æ•°å€¼ï¼ŒèŽ·å– monitor_node è¾“å‡ºçš„ flag

    - éªŒè¯ DDS Discovery åè®®çš„ä¿¡æ¯æ³„æ¼é£Žé™©

---

# 3. é¶åœºå¯åŠ¨æ–¹å¼

åœ¨ `lab2` ç›®å½•ä¸‹æž„å»ºå¹¶å¯åŠ¨é¶åœºï¼š

```bash
sudo docker rm -f quiksand_lab2>/dev/null
sudo docker build -t ros2-discovery-leak-lab .
sudo docker run -it --name quiksand_lab2 ros2-discovery-leak-lab
```

å¯åŠ¨æˆåŠŸåŽï¼Œå®¹å™¨å†…ä¼šè‡ªåŠ¨ï¼š

- source ROS 2 çŽ¯å¢ƒ

- å¯åŠ¨ç›®æ ‡èŠ‚ç‚¹ `quiksend_node2`

- å¯åŠ¨éšè—ç›‘æŽ§èŠ‚ç‚¹ `monitor_node`

- ç›´æŽ¥è¿›å…¥äº¤äº’ shellï¼Œæç¤ºèŠ‚ç‚¹å¯åŠ¨æˆåŠŸ

---

# 4. æ”»å‡»æ–¹å¼ä¸€ï¼šROS 2 å‘½ä»¤è¡ŒæŽ¢æµ‹ï¼ˆå¿«é€ŸéªŒè¯ï¼‰

> é€‚ç”¨äºŽ CTF / æ•™å­¦åœºæ™¯çš„æœ€ç®€å•æ”»å‡»æ–¹å¼ï¼Œæ— éœ€å¤æ‚è„šæœ¬ï¼Œç›´æŽ¥é€šè¿‡ ROS 2 åŽŸç”Ÿå‘½ä»¤èŽ·å–æ•æ„Ÿä¿¡æ¯ã€‚

## 4.1 æ”»å‡»å‘½ä»¤ï¼ˆå®¹å™¨å†…/å®¿ä¸»æœºæ‰§è¡Œï¼‰

ç¬¬ä¸€æ­¥ï¼šåˆ—å‡ºç›®æ ‡èŠ‚ç‚¹çš„æ‰€æœ‰å…¬å¼€/éšè—å‚æ•°

```bash
ros2 param list /quiksend_node2
```

ç¬¬äºŒæ­¥ï¼šè¯»å–å¯ç–‘æ•æ„Ÿå‚æ•°çš„å€¼

```bash
ros2 param get /quiksend_node2 sys.runtime.seed
```

## 4.2 æ”»å‡»åŽŸç†

- ROS 2 å‘½ä»¤è¡Œå·¥å…·ï¼ˆ`ros2 param`ï¼‰åŸºäºŽ DDS Discovery åè®®å·¥ä½œï¼Œå¯è‡ªåŠ¨å‘çŽ°åŒä¸€ Domain å†…çš„èŠ‚ç‚¹åŠå‚æ•°

- ç›®æ ‡èŠ‚ç‚¹æœªå¯¹å‚æ•°è¿›è¡Œè®¿é—®æŽ§åˆ¶ï¼Œæœªéšè—æ•æ„Ÿå‚æ•°æ ‡è¯†ï¼Œå…è®¸ä»»æ„èŠ‚ç‚¹è¯»å–

- æ— éœ€ä¼ªé€ èŠ‚ç‚¹èº«ä»½ï¼Œç›´æŽ¥é€šè¿‡åŽŸç”Ÿå‘½ä»¤å³å¯å®Œæˆå‚æ•°æŽ¢æµ‹ä¸Žè¯»å–ï¼Œæ”»å‡»æˆæœ¬æžä½Ž

## 4.3 æˆåŠŸæ ‡å¿—

å‘½ä»¤æ‰§è¡ŒåŽï¼Œå°†è¾“å‡ºå‚æ•°å€¼åŠ flagï¼Œå®¹å™¨å†…æ—¥å¿—åº”å‡ºçŽ°ï¼š

```text
root@d8144d8e29eb:/ros2_ws# ros2 param list /quiksend_node2
  start_type_description_service
  sys.runtime.seed
  use_sim_time

root@d8144d8e29eb:/ros2_ws# ros2 param get /quiksend_node2 sys.runtime.seed
String value is: flag{Quiksand_lab2_discovery_leak_002}

[FATAL] [monitor_node]: ðŸ´ FLAG: flag{Quiksand_lab2_discovery_leak_002}
```

---

# 5. æ”»å‡»æ–¹å¼äºŒï¼šDDS æµé‡æŠ“åŒ…ï¼ˆçœŸå®žæ”»å‡»ï¼‰

> æ›´è´´è¿‘çœŸå®žæ”»å‡»åœºæ™¯çš„æ–¹å¼ï¼Œæ”»å‡»è€…æ— éœ€ç›´æŽ¥æ‰§è¡Œ ROS 2 å‘½ä»¤ï¼Œé€šè¿‡æŠ“åŒ…å³å¯èŽ·å–å‚æ•°åŠ Topic å…ƒæ•°æ®ã€‚

## 5.1 é…ç½®æŠ“åŒ…çŽ¯å¢ƒï¼ˆå®¿ä¸»æœºæ‰§è¡Œï¼‰

```bash
# æŸ¥çœ‹ç›®æ ‡å®¹å™¨çš„ç½‘ç»œæŽ¥å£
sudo docker inspect quiksand_lab2 | grep NetworkSettings -A 10

# ä½¿ç”¨ TCPDump æŠ“åŒ…ï¼ˆæŒ‡å®šå®¹å™¨ç½‘ç»œæŽ¥å£ï¼‰
sudo tcpdump -i any port 7400-7500 -w dds_discovery.pcap

# æˆ–ä½¿ç”¨ Wireshark å›¾å½¢åŒ–æŠ“åŒ…
sudo wireshark
```

## 5.2 è§£æž DDS Discovery æµé‡

1. å¯åŠ¨æŠ“åŒ…åŽï¼Œåœ¨å®¹å™¨å†…é‡å¯ç›®æ ‡èŠ‚ç‚¹ï¼ˆè§¦å‘ DDS Discovery åè®®äº¤äº’ï¼‰

2. åœæ­¢æŠ“åŒ…ï¼Œç”¨ Wireshark æ‰“å¼€ `dds_discovery.pcap` æ–‡ä»¶

3. è¿‡æ»¤è§„åˆ™ï¼š`rtps`ï¼ˆDDS åº•å±‚ RTPS åè®®ï¼‰ï¼Œç­›é€‰èŠ‚ç‚¹äº¤äº’æ•°æ®åŒ…

4. è§£æžæ•°æ®åŒ…ä¸­çš„â€œParameter Listâ€å­—æ®µï¼Œæå– `sys.runtime.seed` å‚æ•°åç§°åŠå¯¹åº”å€¼

## 5.3 æ”»å‡»æ•ˆæžœ

- æ— éœ€è¿›å…¥å®¹å™¨ã€æ— éœ€æ‰§è¡Œ ROS 2 å‘½ä»¤ï¼Œä»…é€šè¿‡ç½‘ç»œæŠ“åŒ…å³å¯èŽ·å–æ•æ„Ÿå‚æ•°

- å¯åŒæ—¶æ•èŽ·éšè— Topic çš„å…ƒæ•°æ®ï¼ˆå¦‚ Topic åç§°ã€æ¶ˆæ¯ç±»åž‹ï¼‰ï¼Œä¸ºåŽç»­æ”»å‡»é“ºåž«

- æ”»å‡»è¡Œä¸ºéšè”½ï¼Œä¸æ˜“è¢«ç›®æ ‡ç³»ç»Ÿå‘çŽ°ï¼Œé€‚åˆçœŸå®žçŽ¯å¢ƒä¸‹çš„ stealth æ”»å‡»

---

# 6. æ¼æ´žæˆå› åˆ†æž

## 6.1 æ ¸å¿ƒé—®é¢˜

- DDS Discovery åè®®é»˜è®¤æ— åŠ å¯†ã€æ— èº«ä»½è®¤è¯ï¼Œæ‰€æœ‰å…ƒæ•°æ®æ˜Žæ–‡ä¼ è¾“

- ROS 2 èŠ‚ç‚¹æœªé…ç½®å‚æ•°è®¿é—®æŽ§åˆ¶ï¼Œæ•æ„Ÿå‚æ•°æœªéšè—ã€æœªåŠ å¯†å­˜å‚¨

- æœªç¦ç”¨ Multicast Discovery åŠŸèƒ½ï¼ŒèŠ‚ç‚¹ä¸»åŠ¨å¹¿æ’­è‡ªèº«å‚æ•°åŠ Topic ä¿¡æ¯

## 6.2 æ”»å‡»æœ¬è´¨

> **DDS Discovery ä¿¡ä»»æœºåˆ¶è¢«æ»¥ç”¨**

ä»»ä½•èŠ‚ç‚¹åªè¦ï¼š

- æŽ¥å…¥åŒä¸€ DDS Domainï¼ˆé»˜è®¤ Domain 0ï¼Œæ— è®¿é—®é™åˆ¶ï¼‰

- æ”¯æŒ DDS RTPS åè®®ï¼Œå³å¯æ•èŽ·æˆ–äº¤äº’ Discovery æ•°æ®

æ— éœ€ç»•è¿‡ä»»ä½•é˜²æŠ¤ï¼Œç›´æŽ¥åˆ©ç”¨ ROS 2 é»˜è®¤é…ç½®çš„å®‰å…¨çŸ­æ¿ï¼Œå³å¯å®Œæˆä¿¡æ¯çªƒå–ã€‚

---

# 7. é˜²å®ˆæ–¹å‘ï¼ˆé¢„å‘Šï¼‰

è¯¥é¶åœºå¯ç”¨äºŽéªŒè¯ä»¥ä¸‹é˜²å¾¡æŽªæ–½ï¼ŒåŠ å›º ROS 2 èŠ‚ç‚¹å®‰å…¨ï¼ŒæŠµå¾¡ Discovery æ”»å‡»åŠå‚æ•°æ³„æ¼ï¼š

- SROS2 é…ç½®ï¼ˆå¯ç”¨ DDS Security åŠ å¯†ã€èº«ä»½è®¤è¯ï¼‰

- ç¦ç”¨ Multicast Discoveryï¼Œå¯ç”¨ Unicast æˆ– Discovery Server æ¨¡å¼

- å‚æ•°è®¿é—®æŽ§åˆ¶ï¼ˆé…ç½® `permissions.xml`ï¼Œé™åˆ¶æ•æ„Ÿå‚æ•°è¯»å–æƒé™ï¼‰

- æ•æ„Ÿå‚æ•°åŠ å¯†å­˜å‚¨ä¸Žä¼ è¾“ï¼Œéšè—æ ¸å¿ƒå‚æ•°æ ‡è¯†

å¼€å¯é˜²å®ˆåŽï¼š

> æ”»å‡»è€…æ— æ³•é€šè¿‡å‘½ä»¤è¡Œè¯»å–å‚æ•°ã€æ— æ³•é€šè¿‡æŠ“åŒ…è§£æžæ•æ„Ÿæ•°æ®ï¼Œéšè— Topic åŠå‚æ•°å°†æ— æ³•è¢«æŽ¢æµ‹ã€‚

---

# 8. Flag

```text
flag{Quiksand_lab2_discovery_leak_002}
```

---

# 9. é€‚ç”¨åœºæ™¯

- ROS 2 å®‰å…¨æ•™å­¦ï¼ˆDDS Discovery æ”»å‡»åŽŸç†è®²è§£ï¼‰

- æœºå™¨äººå®‰å…¨å®žéªŒï¼ˆå‚æ•°æ³„æ¼ä¸Žé˜²æŠ¤éªŒè¯ï¼‰

- CTF æ”»é˜²é¶åœºï¼ˆROS 2 ä¸“é¡¹é¢˜åž‹è®¾è®¡ï¼‰

- ç ”ç©¶ç”Ÿ/æœ¬ç§‘è¯¾ç¨‹å®žéªŒï¼ˆåµŒå…¥å¼/æœºå™¨äººå®‰å…¨æ–¹å‘ï¼‰

---

**Author**: ROS 2 Security Lab

**Level**: Intermediate / Offensive
> 